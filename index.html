<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQUIG.LINK // TRACKER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&display=swap');
        body { font-family: 'JetBrains Mono', monospace; background-color: #09090b; color: #e4e4e7; }
        .scanline {
            width: 100%; height: 100px; z-index: 10;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255, 255, 255, 0.02) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1; position: absolute; bottom: 100%;
            animation: scanline 10s linear infinite; pointer-events: none;
        }
        @keyframes scanline { 0% { bottom: 100%; } 100% { bottom: -100%; } }
        /* Simple shimmer for loading */
        .loading-shimmer { background: linear-gradient(90deg, #18181b 25%, #27272a 50%, #18181b 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center selection:bg-white selection:text-black">
    <div class="scanline fixed top-0 left-0 w-full h-full pointer-events-none"></div>

    <main class="w-full max-w-2xl px-6 py-12 z-20">
        
        <header class="mb-12 border-b border-zinc-800 pb-8">
            <h1 class="text-xs font-bold tracking-[0.3em] text-zinc-500 mb-6 uppercase">Network_Diagnostics // Status</h1>
            
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4" id="stats-grid">
                <div>
                    <div class="text-[10px] text-zinc-600 uppercase tracking-wider mb-1">Total Graphs</div>
                    <div class="text-2xl font-light text-white" id="stat-total">----</div>
                </div>
                <div>
                    <div class="text-[10px] text-zinc-600 uppercase tracking-wider mb-1">Unique Models</div>
                    <div class="text-2xl font-light text-white" id="stat-unique">----</div>
                </div>
                <div>
                    <div class="text-[10px] text-zinc-600 uppercase tracking-wider mb-1">Sources</div>
                    <div class="text-2xl font-light text-white" id="stat-sources">----</div>
                </div>
                <div>
                    <div class="text-[10px] text-zinc-600 uppercase tracking-wider mb-1">System Time</div>
                    <div class="text-2xl font-light text-white" id="stat-time">--:--</div>
                </div>
            </div>
        </header>

        <div class="mb-8 relative group">
            <input type="text" id="searchInput" placeholder="SEARCH_DATABASE..." 
                class="w-full bg-zinc-900/50 border border-zinc-800 px-4 py-3 text-xs font-mono text-white placeholder-zinc-700 outline-none focus:border-zinc-500 transition-all">
            <div class="absolute right-4 top-3.5 text-[9px] text-zinc-700 pointer-events-none font-mono">F_SEARCH</div>
        </div>

        <div class="flex justify-between items-end mb-4 border-b border-zinc-900 pb-2">
            <span class="text-[10px] text-zinc-500 uppercase tracking-widest" id="feed-label">Incoming Transmission</span>
            <span class="text-[10px] text-zinc-600 animate-pulse">‚óè LIVE</span>
        </div>

        <div id="feed" class="flex flex-col min-h-[400px]">
            <div class="py-12 flex flex-col items-center gap-4">
                <div class="w-full h-12 loading-shimmer rounded-sm"></div>
                <div class="w-full h-12 loading-shimmer rounded-sm opacity-50"></div>
                <div class="text-zinc-700 text-[10px] font-mono tracking-widest uppercase mt-4">Syncing_Data_Link...</div>
            </div>
        </div>

        <footer class="mt-24 text-center">
            <p class="text-[10px] text-zinc-800 uppercase tracking-widest">End of Line</p>
        </footer>
    </main>

    <script>
        let fullHistory = [];

        // CACHE BUSTING: Adding a timestamp ensures GitHub Pages doesn't serve a stale file
        const bust = `?t=${Date.now()}`;

        Promise.all([
            fetch(`./history.json${bust}`).then(r => r.ok ? r.json() : Promise.reject(`History: ${r.status}`)),
            fetch(`./database.json${bust}`).then(r => r.ok ? r.json() : Promise.reject(`DB: ${r.status}`))
        ])
        .then(([historyData, dbData]) => {
            fullHistory = historyData;
            renderFeed(historyData);
            renderStats(dbData);
        })
        .catch(err => {
            console.error("Critical Error:", err);
            document.getElementById('feed').innerHTML = `
                <div class="text-center py-12 border border-red-900/20 bg-red-950/10 px-4">
                    <div class="text-red-600 text-[10px] font-mono mb-2 uppercase tracking-tighter italic">! Error_Signal_Lost</div>
                    <div class="text-red-900 text-[9px] font-mono lowercase">reason: ${err}</div>
                    <button onclick="location.reload()" class="mt-4 text-[9px] border border-red-900/50 px-3 py-1 text-red-700 hover:bg-red-900 hover:text-white transition-all uppercase font-mono">Re-Initialize</button>
                </div>`;
        });

        function renderStats(db) {
            const sources = Object.keys(db).length;
            let totalGraphs = 0;
            let uniqueModels = new Set();

            for (const reviewer in db) {
                db[reviewer].forEach(item => {
                    totalGraphs++;
                    uniqueModels.add(item.toLowerCase().trim());
                });
            }

            animateValue("stat-total", 0, totalGraphs, 1200);
            animateValue("stat-unique", 0, uniqueModels.size, 1200);
            document.getElementById('stat-sources').innerText = sources;
            
            const now = new Date();
            document.getElementById('stat-time').innerText = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        }

        function renderFeed(data) {
            const feed = document.getElementById('feed');
            if (!data || data.length === 0) {
                feed.innerHTML = '<div class="py-12 text-zinc-700 text-[10px] text-center font-mono">NO SIGNALS DETECTED IN LOCAL SECTOR.</div>';
                return;
            }

            feed.innerHTML = data.map(item => `
                <div class="group py-6 border-b border-zinc-900/50 flex flex-col gap-2 hover:bg-zinc-900/20 transition-colors px-2 -mx-2">
                    <div class="flex justify-between items-baseline opacity-50 group-hover:opacity-100 transition-opacity">
                        <span class="text-[9px] font-mono text-zinc-400 uppercase tracking-widest">[ ${item.reviewer} ]</span>
                        <span class="text-[9px] font-mono text-zinc-600">${item.date}</span>
                    </div>
                    <div class="flex justify-between items-center gap-4">
                        <h2 class="text-sm md:text-base font-light text-zinc-300 break-words flex-1 group-hover:text-white transition-colors">
                            ${item.item}
                        </h2>
                        <a href="${item.link}" target="_blank" 
                           class="text-[9px] font-mono border border-zinc-800 text-zinc-500 px-3 py-1.5 
                                  hover:bg-white hover:text-black hover:border-white transition-all 
                                  uppercase tracking-widest shrink-0">
                            View_Graph
                        </a>
                    </div>
                </div>
            `).join('');
        }

        // Simple Search Logic
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const filtered = fullHistory.filter(h => 
                h.item.toLowerCase().includes(query) || 
                h.reviewer.toLowerCase().includes(query)
            );
            document.getElementById('feed-label').innerText = query ? `Search Results: ${filtered.length}` : 'Incoming Transmission';
            renderFeed(filtered);
        });

        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if(!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }
    </script>
</body>
</html>
